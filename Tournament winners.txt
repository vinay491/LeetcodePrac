/*  https://leetcode.com/problems/tournament-winners/  */

WITH SCORES AS 
(
SELECT PLAYER, SUM(SCORE) AS SCR FROM (
SELECT FIRST_PLAYER AS PLAYER, SUM(FIRST_SCORE) AS SCORE FROM MATCHES GROUP BY FIRST_PLAYER
UNION ALL
SELECT SECOND_PLAYER AS PLAYER, SUM(SECOND_SCORE) AS SCORE FROM MATCHES GROUP BY SECOND_PLAYER
    )A GROUP BY PLAYER
    )
    
SELECT GROUP_ID, PLAYER_ID FROM (
SELECT B.GROUP_ID, A.PLAYER AS PLAYER_ID, A.SCR,
ROW_NUMBER()OVER(PARTITION BY B.GROUP_ID ORDER BY A.SCR DESC, A.PLAYER) AS SEQ
FROM SCORES A LEFT JOIN PLAYERS B ON (A.PLAYER = B.PLAYER_ID)
) WHERE SEQ = 1